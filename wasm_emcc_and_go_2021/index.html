<!DOCTYPE html>
<html lang="en">
<head>
    <title>WASM: Emscripten, Rust and Golang</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="shower/themes/material/styles/styles.css" />
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
    </style>
</head>
<body class="shower list">

    <header class="caption">
      <h1>WASM: Emscripten, Rust and Golang</h1>
      <p>Oleksii Vasyliev, Railsware</p>
    </header>

    <section class="slide" id="Cover">
      <h2>WASM: Emscripten, Rust and Golang</h2>
      <p>Brought to you by <a href="http://leopard.in.ua/">Alexey Vasiliev</a>, <a
          href="http://railsware.com/">Railsware</a></p>
      <!--
          To apply styles to the certain slides
          set slide ID to get needed elements
          -->
      <style>
        #Cover {
          background-color: #04A05F;
        }

        #Cover h2 {
          margin: 50px 0 0;
          color: #FFF;
          text-align: left;
          font-weight: bold;
          font-size: 66px;
          line-height: 130%;
        }

        #Cover p {
          margin: 50px 0 0;
          text-align: left;
          color: #FFF;
          font-style: italic;
          font-size: 20px;
        }

        #Cover p a {
          color: #FFF;
        }
      </style>
    </section>

    <section class="slide" id="AboutMeSlide">
      <div>
        <h2>Oleksii Vasyliev</h2>
        <ul>
          <li>Web and Mobile Developer, DevOps</li>
          <li>Open-Source libs: <a href="https://github.com/certonid/certonid">Certonid</a>, <a
              href="https://github.com/le0pard/storybook-addon-root-attribute">Storybook Addon Root Attribute</a>, <a
              href="http://pgtune.leopard.in.ua/">PGTune</a>, <a href="http://sql-joins.leopard.in.ua/">SQL Joins
              Visualizer</a>, etc</li>
          <li>Leading <a href="http://www.rwpod.com/">RWpod</a> podcast about Ruby and JavaScript</li>
        </ul>
      </div>
    </section>

    <section class="slide" id="WASMBasicsCover">
      <h2 class="shout">WebAssembly (WASM)</h2>
    </section>

    <section class="slide" id="WASMBasicsIntro">
      <div>
        <h2>WASM goals</h2>
        <div class="columns two">
          <ul>
            <li>Be fast, efficient, and portable</li>
            <li>Be readable and debuggable</li>
            <li>Keep secure</li>
            <li>Don't break the web</li>
          </ul>
          <div>
            <img src="pictures/wasm.svg" alt="cat explorer" />
          </div>
        </div>
      </div>
      <style>
        #WASMBasicsIntro img {
          width: 250px;
        }
      </style>
    </section>

    <section class="slide" id="WasmVsJs">
      <div>
        <h2>WebAssembly is a different language from JavaScript</h2>
        <ul>
          <li>JavaScript is a high-level language, flexible and expressive enough to write web applications</li>
          <li>WebAssembly is a low-level assembly-like language with a compact binary format that runs with near-native performance</li>
        </ul>
      </div>
      <style>
        #CSSArchitectureIntro img {
          width: 370px;
        }
      </style>
    </section>

    <section class="slide" id="WasmHowTo">
      <div>
        <img class="cover" src="pictures/wasm_howto.jpeg" alt="WasmHowTo" />
      </div>
    </section>

    <section class="slide" id="WASMKeyConcepts">
      <div>
        <h2>Key concepts</h2>
        <ul>
          <li><strong>Module</strong>: Represents a WebAssembly binary that has been compiled by the browser into executable
            machine code. A Module is stateless and thus, like a Blob, can be explicitly shared between windows and workers (via
            postMessage())</li>
          <li><strong>Memory</strong>: A resizable ArrayBuffer that contains the linear array of bytes read and written by WebAssembly‚Äôs low-level memory access instructions</li>
          <li><strong>Table</strong>: A resizable typed array of references (e.g. to functions) that could not otherwise be stored as raw bytes in
          Memory (for safety and portability reasons)</li>
          <li><strong>Instance</strong>: A Module paired with all the state it uses at runtime including a Memory, Table, and set of imported values</li>
        </ul>
      </div>
      <style>
        #WASMKeyConcepts li {
          font-size: 1.2rem;
        }
      </style>
    </section>

    <section class="slide" id="EmscriptenCover">
      <h2 class="shout">Emscripten</h2>
    </section>

    <section class="slide" id="EmscriptenConcepts">
      <div>
        <h2>Emscripten</h2>
        <p>The Emscripten tool is able to take just about any C/C++ source code and compile it into a .wasm module, plus the
          necessary JavaScript "glue" code for loading and running the module, and an HTML document to display the results
          of the code</p>
        <img class="place b" src="pictures/emscripten-diagram.png" alt="Emscripten" />
      </div>
      <style>
        #EmscriptenConcepts img {
          margin: 3rem 0;
        }
      </style>
    </section>

    <section class="slide" id="EmscriptenCode">
      <div>
        <pre><code>#include &lt;emscripten.h&gt;

EMSCRIPTEN_KEEPALIVE
int fib(int n) {
  if(n &lt;= 0){
    return 0;
  }
  int i, t, a = 0, b = 1;
  for (i = 1; i &lt; n; i++) {
    t = a + b;
    a = b;
    b = t;
  }
  return b;
}</code></pre>
      </div>
      <style>
        #EmscriptenCode code {
          font-size: 1rem;
        }
      </style>
    </section>

    <section class="slide" id="EmscriptenCompile">
      <div>
        <h2>Emcc - Emscripten compiler command</h2>
        <pre><code>emcc -O3 -s WASM=1 -s EXTRA_EXPORTED_RUNTIME_METHODS='["cwrap"]' fib.c</code></pre>
      </div>
      <style>
        #EmscriptenCompile code {
          font-size: 1.2rem;
        }
      </style>
    </section>

    <section class="slide" id="EmscriptenWeb">
      <div>
        <pre><code>&lt;script src=&quot;a.out.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  Module.onRuntimeInitialized = _ =&gt; {
    const fib = Module.cwrap(&apos;fib&apos;, &apos;number&apos;, [&apos;number&apos;]);
    console.log(fib(12));
  };
&lt;/script&gt;</code></pre>
      </div>
      <style>
        #EmscriptenWeb code {
          font-size: 1rem;
        }
      </style>
    </section>

    <section class="slide" id="EmscriptenWeb2">
      <div>
        <pre><code>&lt;script&gt;
  (async function() {
    const imports = {
      env: {
        memory: new WebAssembly.Memory({initial: 1}),
        STACKTOP: 0,
      }
    };
    const {instance} = await WebAssembly.instantiateStreaming(
      fetch(&apos;/a.out.wasm&apos;),
      imports
    );
    console.log(instance.exports._fib(12));
  })();
&lt;/script&gt;</code></pre>
      </div>
      <style>
        #EmscriptenWeb2 code {
          font-size: 1rem;
        }
      </style>
    </section>

    <section class="slide" id="EmscriptenLibs">
      <div>
        <h2>Compiling a C library</h2>
        <pre><code>emcc -O3 -s WASM=1 -s EXTRA_EXPORTED_RUNTIME_METHODS='["cwrap"]' \
    -I libwebp \
    webp.c \
    libwebp/src/{dec,dsp,demux,enc,mux,utils}/*.c</code></pre>
      </div>
      <style>
        #EmscriptenLibs code {
          font-size: 1rem;
        }
      </style>
    </section>

    <section class="slide" id="EmscriptenWebp">
      <div>
        <h2>Webp Wasm</h2>
        <ul>
          <li><a href="https://webp.leopard.in.ua/#/">Application Demo</a></li>
          <li><a href="https://github.com/le0pard/webp-wasm">Application Repo</a></li>
          <li><a href="https://github.com/le0pard/webp-wasm/blob/master/webpack/lib/wasmWebp.js">JS code</a></li>
        </ul>
      </div>
    </section>

    <section class="slide" id="RustCover">
      <h2 class="shout">Rust</h2>
    </section>

    <section class="slide" id="RustInstall">
      <div>
        <h2><a href="https://rustwasm.github.io/wasm-pack/">Wasm-pack</a></h2>
        <div class="columns two">
          <pre><code>cargo install wasm-pack
npm install -g wasm-pack
yarn global add wasm-pack</code></pre>
          <div>
            <img src="pictures/wasm-ferris.png" alt="wasm" />
          </div>
        </div>
      </div>
      <style>
        #RustInstall code {
          font-size: 1.4rem;
        }
        #RustInstall img {
          width: 100%;
        }
      </style>
    </section>

    <section class="slide" id="RustCode">
      <div>
        <pre><code>use wasm_bindgen::prelude::*;

#[wasm_bindgen]
extern {
    pub fn alert(s: &amp;str);
}

#[wasm_bindgen]
pub fn greet(name: &amp;str) {
    alert(&amp;format!(&quot;Hello, {}!&quot;, name));
}</code></pre>
      </div>
      <style>
        #RustCode code {
          font-size: 1rem;
        }
      </style>
    </section>

    <section class="slide" id="RustBuild">
      <div>
        <pre><code>$ wasm-pack build
[INFO]: üéØ Checking for the Wasm target...
[INFO]: üåÄ Compiling to Wasm...
Compiling proc-macro2 v1.0.32
Compiling unicode-xid v0.2.2
Compiling log v0.4.14
Compiling syn v1.0.82
Compiling wasm-bindgen-shared v0.2.78
...
Compiling js-sys v0.3.55
Compiling console_error_panic_hook v0.1.7
Compiling web-sys v0.3.55
Compiling wasm-game-of-life v0.1.0 (/Users/leo/Downloads/wasm_game_of_life)
Finished release [optimized] target(s) in 17.17s
[INFO]: ‚¨áÔ∏è Installing wasm-bindgen...
[INFO]: Optimizing wasm binaries with `wasm-opt`...
[INFO]: Optional fields missing from Cargo.toml: 'description', 'repository', and 'license'. These are not necessary,
but recommended
[INFO]: ‚ú® Done in 21.55s</code></pre>
      </div>
      <style>
        #RustBuild code {
          font-size: 0.8rem;
        }
      </style>
    </section>

    <section class="slide" id="RustJS">
      <div>
        <h2>Using the package on the web</h2>
        <pre><code>&lt;script type=&quot;module&quot;&gt;
import init, {greet} from &quot;./pkg/hello_wasm.js&quot;;
init()
  .then(() =&gt; {
    greet(&quot;WebAssembly&quot;)
  });
&lt;/script&gt;</code></pre>
      </div>
      <style>
        #RustJS code {
          font-size: 1rem;
        }
      </style>
    </section>

    <section class="slide" id="RustGameOfLife">
      <div>
        <h2>Conway's Game of Life</h2>
        <div class="columns two">
          <ul>
            <li><a href="https://github.com/rustwasm/wasm_game_of_life">Application Repo</a></li>
          </ul>
          <img src="pictures/game_of_life.png" alt="Conways Game of Life in Rust and WebAssembly" />
        </div>
      </div>
      <style>
        #RustGameOfLife img {
          width: 95%;
        }
      </style>
    </section>

    <section class="slide" id="RustCrates1">
      <div>
        <h2>Rust crates for WASM development</h2>
        <ul class="columns two">
          <li><a href="https://github.com/rustwasm/wasm-bindgen">wasm-bindgen</a> - high-level interactions between Rust and JavaScript</li>
          <li><a href="https://github.com/rustwasm/wasm-bindgen/tree/main/crates/futures">wasm-bindgen-futures</a> - bridge connecting JavaScript Promises and Rust Futures</li>
          <li><a href="https://github.com/rustwasm/wasm-bindgen/tree/main/crates/js-sys">js-sys</a> - imports for all the JavaScript global types and methods, such as Object, Function, eval, etc</li>
          <li><a href="https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys">web-sys</a> - imports for all the Web's APIs, such as DOM manipulation, setTimeout, Web GL, Web Audio, etc</li>
          <li><a href="https://github.com/rustwasm/console_error_panic_hook">console_error_panic_hook</a> - lets you debug panics on wasm32-unknown-unknown by providing a panic hook that forwards panic messages to console.error</li>
          <li><a href="https://github.com/iamcodemaker/console_log">console_log</a> - a backend for the log crate that routes logged messages to the devtools console</li>
        </ul>
      </div>
      <style>
        #RustCrates1 li {
          font-size: 1.2rem;
        }
      </style>
    </section>

    <section class="slide" id="RustCrates2">
      <div>
        <h2>Rust crates for WASM development</h2>
        <ul class="columns two">
          <li><a href="https://github.com/rustwasm/wee_alloc">wee_alloc</a> - the Wasm-Enabled, Elfin Allocator. A small (~1K uncompressed .wasm) allocator implementation for when code size is a
          greater concern than allocation performance</li>
          <li><a href="https://github.com/paritytech/parity-wasm">parity-wasm</a> - low-level WebAssembly format library for serializing, deserializing, and building .wasm binaries</li>
          <li><a href="https://github.com/yurydelendik/wasmparser.rs">wasmparser</a> - a simple, event-driven library for parsing WebAssembly binary files</li>
          <li><a href="https://github.com/bytecodealliance/wasmtime/tree/main/cranelift">cranelift-wasm</a> - compile WebAssembly to the native host's machine code. Part of the Cranelift (n√© Cretonne) code generator project</li>
        </ul>
      </div>
      <style>
        #RustCrates2 li {
          font-size: 1.2rem;
        }
      </style>
    </section>

    <section class="slide" id="GolangCover">
      <h2 class="shout">Golang</h2>
    </section>

    <section class="slide" id="GoWasmIntro1">
      <div>
        <h2>Go + WASM is an Application, not a Library</h2>
        <pre><code>package main
import (
  "fmt"
)

func main() {
  fmt.Println("Hello World")
  // Prevent the function from returning, which is required in a wasm module
  <-make(chan bool)
}</code></pre>
      </div>
      <style>
        #GoWasmIntro1 code {
          font-size: 1rem;
        }
      </style>
    </section>

    <section class="slide" id="GoWasmIntro2">
      <div>
        <h2>Go + WASM is an Application, not a Library</h2>
        <pre><code>cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" .
GOOS=js GOARCH=wasm go build -o main.wasm</code></pre>
      </div>
      <style>
        #GoWasmIntro2 code {
          font-size: 1.3rem;
        }
      </style>
    </section>

    <section class="slide" id="GoWasmIntro3">
      <div>
        <pre><code>const loadWasm = (path) => {
  const go = new Go()

  return new Promise((resolve, reject) => {
    WebAssembly.instantiateStreaming(fetch(path), go.importObject)
    .then(result => {
      go.run(result.instance)
      resolve(result.instance)
    })
    .catch(error => {
      reject(error)
    })
  })
}
// Load the wasm file
loadWasm("main.wasm").then(wasm => {
    console.log("main.wasm is loaded ")
}).catch(error => {
    console.error("ouch", error)
}) </code></pre>
      </div>
      <style>
        #GoWasmIntro3 code {
          font-size: 0.75rem;
        }
      </style>
    </section>

    <section class="slide" id="GoWasmDom1">
      <div>
        <h2>Work with DOM</h2>
        <pre><code>package main
import (
    "syscall/js"
)

func main() {

  message := "Hello World"

  document := js.Global().Get("document")
  h2 := document.Call("createElement", "h2")
  h2.Set("innerHTML", message)
  document.Get("body").Call("appendChild", h2)

  <-make(chan bool)
}</code></pre>
      </div>
      <style>
        #GoWasmDom1 code {
          font-size: 0.8rem;
        }
      </style>
    </section>

    <section class="slide" id="GoWasmDom2">
      <div>
        <h2>Work with DOM</h2>
        <pre><code>func MyGoFunc() js.Func {
	return js.FuncOf(func(this js.Value, args []js.Value) interface{} {
		// Get the current time as a Go time.Time object
		now := time.Now()
		// Get the Date object constructor from JavaScript
		dateConstructor := js.Global().Get("Date")
		// Return a new JS "Date" object with the time from the Go "now" variable
		// We're passing the UNIX timestamp to the "Date" constructor
		// Because JS uses milliseconds for UNIX timestamp, we need to multiply the timestamp by 1000
		return dateConstructor.New(now.Unix() * 1000)
	})
}</code></pre>
      </div>
      <style>
        #GoWasmDom2 code {
          font-size: 0.8rem;
        }
      </style>
    </section>

    <section class="slide" id="GoWasmTypes">
      <div>
        <h2>Go types &lt;-&gt; JavaScript types</h2>
        <pre><code>| Go                     | JavaScript             |
| ---------------------- | ---------------------- |
| js.Value               | [its value]            |
| js.Func                | function               |
| nil                    | null                   |
| bool                   | boolean                |
| integers and floats    | number                 |
| string                 | string                 |
| []interface{}          | new array              |
| map[string]interface{} | new object             |</code></pre>
      </div>
      <style>
        #GoWasmTypes code {
          font-size: 0.9rem;
        }
      </style>
    </section>

    <section class="slide" id="GoWasmCons">
      <div>
        <h2>Unsupported in GO WASM</h2>
        <ul>
          <li>no C bindings</li>
          <li>no system dependencies such as file system or network (database server for example)</li>
        </ul>
      </div>
    </section>

    <section class="slide" id="GoWasmVmail">
      <div>
        <h2>Vmail Wasm</h2>
        <ul>
          <li><a href="https://vmail.leopard.in.ua/">Application Demo</a></li>
          <li><a href="https://github.com/le0pard/vmail">Application Repo</a></li>
        </ul>
      </div>
    </section>

    <section class="slide" id="GoWasmOptimizations">
      <div>
        <h2>Optimizations</h2>
        <ul>
          <li>gzip + <a href="https://github.com/nodeca/pako">pako</a></li>
          <li><a href="https://tinygo.org/">TinyGo</a></li>
        </ul>
      </div>
    </section>

    <section class="slide" id="ConclusionCover">
      <h2 class="shout">Conclusion</h2>
    </section>

    <section class="slide" id="QuestionsSlide"><div>
      <h2>&lt;Thank You!&gt; Questions?</h2>
      <div class="contacts">
        <h3>Contact information</h3>
        <ul>
          <li>web: <a href="http://leopard.in.ua/">leopard.in.ua</a></li>
          <li>github: <a href="https://github.com/le0pard">le0pard</a></li>
          <li>twitter: <a href="https://twitter.com/leopard_me">@leopard_me</a></li>
        </ul>
      </div>
      <img src="pictures/questions.png" alt="QuestionsSlide" class="place l b" />
      <style>
        #QuestionsSlide .contacts {
          margin-top: 100px;
          margin-left: 450px;
        }
      </style>
    </div></section>

    <div class="progress"></div>

    <script src="shower/shower.min.js"></script>
    <!-- Copyright ¬© 2019 Yours Truly, Famous Inc. -->

</body>
</html>
